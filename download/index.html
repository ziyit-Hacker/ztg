<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>ZIYIT download</title>
    <link rel="icon" href="../assets/ziyit.png" type="image/x-icon">
    <script src="../assets/f12check.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }

            div[style*="max-width: 400px"] {
                width: 90%;
                margin: 10px auto;
                padding: 15px;
            }

            input,
            select {
                width: 100%;
            }

            button {
                width: 100%;
                padding: 12px;
            }
        }
    </style>
    <style>
        nav {
            display: flex;
            justify-content: space-between;
            padding: 10px;
        }

        .product-grid {
            display: flex;
            flex-wrap: wrap;
        }

        .product {
            margin: 10px;
        }

        .brg {
            text-align: left;
        }

        a {
            text-decoration: none;
        }

        * {
            cursor: default !important;
        }
    </style>
</head>

<body background="../assets/bgl.jpg" style=" background-repeat:no-repeat ;
        background-size:100% 100%;
        background-attachment: fixed;">
    <script>
        // 检查用户权限
        function checkUserPermission() {
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                alert('请先登录以访问该页面');
                window.location.href = './';
                return;
            }
        }

        // 页面加载时检查权限
        document.addEventListener('DOMContentLoaded', checkUserPermission);
    </script>
    <a href="../">返回主页</a>
    <hr>
    <!-- <marquee style="background-color: yellow;">
        <strong>
            <span
                style="color: red;">搜索功能现处于测试阶段!!!如发现bug请将bug描述邮件发送到3950140506@qq.com。如果想要提交改进，请联系邮箱3950140506@qq.com。有任何想法都可以发送短信到13112345678。</span>
        </strong>
    </marquee>
    <hr> -->
    <h1 id="up">欢迎来到只因下载主页</h1>
    <h2>在只因科技的下载主页你可以下载付费程序和免费程序。</h2>
    <h4>我们会提供对你们有帮助的工具！</h4>
    <h3>以下是只因科技提供的产品，请自行下载</h3>
    <hr>
    <a href=".\errordiv">高级权限下载区域</a>
    <hr>
    <style>
        ul {
            width: 650px;
            height: 700px;
            color: red;
            background-color: white;
            list-style-image: url(lbc.png)
        }
    </style>
    <div id="search" style="text-align: center; margin: 20px auto; max-width: 600px;">
        <form method="get" style="display: flex;" autocomplete="off">
            <label for="search-input" style="font-size: 24px; color: #1b222e"><strong>搜索文件: </strong></label>
            <input type="text" id="search-input" name="q" placeholder="搜索..."
                style="flex: 1; padding: 10px; font-size: 16px; border: 1px solid #0078d4; border-radius: 100px 0 0 100px; outline: none;">
            <button type="submit" id="search-button"
                style="padding: 10px 15px; background-color: #0078d4; color: white; border: none; border-radius: 0 100px 100px 0; cursor: pointer; width: auto;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"
                    style="vertical-align: middle;">
                    <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
            </button>
        </form>
    </div>
    <ul class="product-grid">
    </ul>
    <a href="#up">
        <img src="../assets/up.png" alt="到顶部">
    </a>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <p>&copy;2025&nbsp;&nbsp;ZIYIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>版权所有，侵权必究</strong></p>
    <script>
        fetch('download.txt')
            .then(Response => Response.text())
            .then(data => {
                const productGrid = document.querySelector('.product-grid');
                const products = data.split('\n')
                products.forEach(product => {
                    const [name, location] = product.split('\\');
                    const productElement = document.createElement('a');
                    productElement.href = location;
                    productElement.textContent = name;
                    productElement.classList.add('product');
                    productGrid.appendChild(productElement);
                })
            })
    </script>

    <script>
        document.getElementById('search-button').addEventListener('click', function(e) {
            e.preventDefault();
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const products = document.querySelectorAll('.product-grid .product');
            
            products.forEach(product => {
                product.style.display = 'none';
                if (product.textContent.toLowerCase().includes(searchInput)) {
                    product.style.display = 'block';
                }
            });
        });
    </script>

    <audio src="../assets/bm.mp3" style="display: none;"></audio>

    <script>
        // 第二事件：循环播放背景音乐
        // 控制音乐播放状态的变量
        let isPlay = false;
        // 获取音频元素
        const audio = document.querySelector('audio');
        // 修改背景音乐列表，添加新的音乐文件
        const bgmList = ['../assets/bm.mp3', '../assets/bm2.mp3', '../assets/bm3.mp3', '../assets/bm4.mp3'];

        // 随机选择一首背景音乐
        function selectRandomBgm() {
            const randomIndex = Math.floor(Math.random() * bgmList.length);
            return bgmList[randomIndex];
        }

        // 设置音频循环播放
        audio.loop = false; // 关闭原生循环，使用自定义循环

        // 音频播放结束事件监听器
        audio.addEventListener('ended', () => {
            audio.src = selectRandomBgm();
            if (isPlay) {
                audio.play().catch((error) => {
                    console.error('切换播放音频失败:', error);
                });
            }
        });

        // 定义处理首次交互播放音频的函数
        const startAudioOnFirstInteraction = () => {
            audio.src = selectRandomBgm(); // 首次播放随机选择一首
            audio.play()
                .then(() => {
                    isPlay = true;
                    // 定义交互事件数组
                    const events = ['click', 'touchstart', 'keydown', 'mousedown'];
                    // 移除 document 上的交互事件监听器
                    events.forEach((event) => {
                        document.removeEventListener(event, startAudioOnFirstInteraction);
                    });
                })
                .catch((error) => {
                    console.error('播放音频失败:', error);
                });
        };

        // 监听用户交互事件
        const interactionEvents = ['click', 'touchstart', 'keydown', 'mousedown'];
        interactionEvents.forEach((event) => {
            document.addEventListener(event, startAudioOnFirstInteraction);
        });

        // 为音频元素添加点击事件监听器，用于切换播放和暂停状态
        audio.addEventListener('click', () => {
            if (isPlay) {
                audio.pause();
                isPlay = false;
            } else {
                audio.play()
                    .then(() => {
                        isPlay = true;
                    })
                    .catch((error) => {
                        console.error('切换播放音频失败:', error);
                    });
            }
        });

        // 调用切换轮播图的函数
        toggle();
    </script>
</body>

</html>
